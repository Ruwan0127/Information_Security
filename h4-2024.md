# Encrypt and decrypt a message

1st get updates
($ sudo apt-get update)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/7adebb40-3685-4b4e-88e7-3ddf3d3e1c87)

Then gpg encription tool is installed
($ sudo apt-get install gpg micro psmisc)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/cdb7f6be-4ff9-4db0-a972-17cf03f3dffa)


Then key pair is generated.
($ gpg --gen-key)
I did not protect the key with password. I left it empty (twice)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/e6a73288-0d66-4bfd-9fb4-00680c944fd3)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/01bc574c-dd0d-4650-98e9-debeda0b3091)


Now I have a keypair. I have picked only interesting lines of the output.

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/4e59ebec-9863-401a-855e-3c917adfd3a7)

## Export My Public Key

I used the following code 
($ cd
$ gpg --export --armor --output ruwan.pub)

Then I have the public key

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/62786e61-e3a3-4116-9cd8-8e63708b802f)


## Nilu, Simulated

Directory Nilu is created
($ cd
$ mkdir Nilu/
$ chmod og-rwx Nilu/)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/4e124410-e141-4ffd-87d4-3d9b0548a491)

To simulate Nilu, we can just work inside this folder, and replace 'gpg' with 'gpg --homedir .' 
This way, Nilu has her own settings and own keyring, separate from the one we actually use

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/3766181f-75b5-46f8-a8fa-2ba45b73b137)


It's time for Nilu to create her own keypair.
($ gpg --homedir . --gen-key)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/811b3fc3-41b9-428b-a235-694b0f930701)


Nilu imports and verifies Ruwan's Key
($ cd
$ cp -v ruwan.pub Nilu/)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/62e90db2-ac2d-4083-97ce-77d70ef3a070)


Nilu can check the fingerprint to verify that this is indeed Ruwan's key.
($ gpg --homedir . --fingerprint)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/e8746588-f7a6-453f-a145-e31f64039e1b)

Nilu signs ruwan's key to mark it as trusted.

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/2cd09d25-9d13-44ba-a8ae-357e54c7563d)

Keys could also be verified using singatures from trusted third parties. (ignore the 2nd one)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/179b1935-55b7-461f-95f7-d687188bf34b)


## Ruwan needs Nilu's Public Key to Know It's Her

Nilu wants to sign her messages. ruwan needs Nilu's key to know that it's really her.

Nilu:
($ gpg --homedir . --export --armor --output alice.pub
$ cp -v alice/alice.pub .)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/f2654488-7a07-47aa-a7dd-1261d3418ea5)

Key is sent over untrusted channel and ruwan imports the key
($ cd 
$ cp -v Nilu/Nilu.pub .
$ gpg --import Nilu.pub)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/affc9529-526e-4cf1-8bc2-2d98cbe6146e)

Then verify fingerprint...
($ gpg --sign-key "B20F D80B 705C 791D C878  0030 7BAA 4F13 2645 134F")

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/255f430e-e439-45f2-8be8-3b4304db01f9)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/cc1c26e3-8a0e-4dc8-92b1-dfb6dbbd2ce2)

### Trust Established


# Nilu Sends a Secret Message

Nilu writes a message 
($ cd ~/alice/
$ micro message.txt)

Nilu's message

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/9e1a6262-9900-43d4-a2f1-d69adff3ac81)

Then save by Ctrl-S and quit by Ctrl-Q.

She encrypts and signs the message

($ gpg --homedir . --encrypt --recipient ruwan@example.com.invalid --sign --output encrypted.pgp --armor message.txt)

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/5d7991a4-5fa3-45d6-8ef4-12de06218ca7)

## Ruwan Decrypts and Verifies the Message

![image](https://github.com/Ruwan0127/rumarkdown/assets/144318600/8753156b-74d7-464f-8f4e-00d4ba512453)

Nilu's signature was verified using Nilu's public key.


